<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>CassKop Blog</title>
        <link>https://cscetbon.github.io/casskop/blog</link>
        <description>CassKop Blog</description>
        <lastBuildDate>Thu, 26 Mar 2020 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Casskop 0.5.1 - Dynamic sidecars and storage configuration feature]]></title>
            <link>https://cscetbon.github.io/casskop/blog/dynamics_sidecars_storage</link>
            <guid>https://cscetbon.github.io/casskop/blog/dynamics_sidecars_storage</guid>
            <pubDate>Thu, 26 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[In a previous post, I was talking about how Setting up Cassandra Multi-Site on Google Kubernetes Engine with Casskop.]]></description>
            <content:encoded><![CDATA[<p>In a previous post, I was talking about how <a href="/casskop/blog/2020/01/15/multicasskop_gke">Setting up Cassandra Multi-Site on Google Kubernetes Engine with Casskop</a>.
Since then, two new versions <a href="https://github.com/cscetbon/casskop/releases/tag/v0.5.1-release" target="_blank" rel="noopener noreferrer">0.5.1</a> and <a href="https://github.com/cscetbon/casskop/releases/tag/v0.5.2-release" target="_blank" rel="noopener noreferrer">0.5.2</a> had been released.
In another post, Cyril Scetbon focused on the <a href="https://medium.com/@cscetbon/new-probes-in-casskop-0-5-1-bfd1d6547967" target="_blank" rel="noopener noreferrer">New Probes feature</a> which was added with the [PR #184Ø(<a href="https://github.com/cscetbon/casskop/pull/184" target="_blank" rel="noopener noreferrer">https://github.com/cscetbon/casskop/pull/184</a>), in this post I will focus on the dynamic sidecars and storage configurations added to the operator, which give more flexibility to users to configure their Cassandra cluster deployments.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="purposes">Purposes<a href="#purposes" class="hash-link" aria-label="Direct link to Purposes" title="Direct link to Purposes">​</a></h2><p>During our production migration from bare metal Cassandra Cluster to Kubernetes, the main challenge was to perform the smoothest transition for our OPS teams, allowing them to reuse their homemade tools, to facilitate the cluster operationalization.
However, the operator in this previous form did not leave much room for tuning statefulset and therefore the Cassandra Cluster deployed.
You could use the bootstrap image to customize your cassandra node configuration, but not for the tools revolving around.
That is why we added to the <strong>CassandraCluster</strong> the possibility to define containers into the pod in addition to the cassandra ones, these are the <strong>sidecars</strong>, and to configure extract storage for the pods (ie <strong>VolumeClaimTemplates</strong> to the Statefulset configuration).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dynamics-sidecars-configurations">Dynamics sidecars configurations<a href="#dynamics-sidecars-configurations" class="hash-link" aria-label="Direct link to Dynamics sidecars configurations" title="Direct link to Dynamics sidecars configurations">​</a></h2><p>To keep the <a href="https://cloud.google.com/blog/products/gcp/7-best-practices-for-building-containers" target="_blank" rel="noopener noreferrer">container’s best practices</a> and address our OPS needs, we added the ability to define a dynamic list of containers into a <strong>CassandraCluster.Spec</strong> resource definition: <a href="https://github.com/cscetbon/casskop/blob/master/pkg/apis/db/v2/cassandracluster_types.go#L803" target="_blank" rel="noopener noreferrer">cassandracluster_types.go#L803</a>.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sidecarConfigs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">"tail"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"-F"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"/var/log/cassandra/system.log"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ez123/alpine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">tini</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cassandra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 50m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 50Mi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10Mi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /var/log/cassandra</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cassandra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">logs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">"tail"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"-F"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"/var/log/cassandra/gc.log.0.current"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ez123/alpine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">tini</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 50m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 50Mi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10Mi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /var/log/cassandra</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">logs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These sidecars are classic <a href="https://godoc.org/k8s.io/api/core/v1#Container" target="_blank" rel="noopener noreferrer">kubernetes container resources</a>, leaving you the full power on what you want to do.
With this example, we add two simple sidecars allowing to distinguish cassandra and GC logs in two different stdout.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>with this feature you can do everything you want, and obviously some bad things. This feature is not here to make a Cassandra Cluster works, the operator has everything for this, but to allow you to simplify some add-ons usage around Cassandra.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sidecars--environment-variables">Sidecars : environment variables<a href="#sidecars--environment-variables" class="hash-link" aria-label="Direct link to Sidecars : environment variables" title="Direct link to Sidecars : environment variables">​</a></h2><p>All sidecars added with this configuration will have, at the container init, some of the environment variables from <strong>cassandra container</strong> merged with those defined into the sidecar container</p><ul><li>CASSANDRA_CLUSTER_NAME</li><li>CASSANDRA_SEEDS</li><li>CASSANDRA_DC</li><li>CASSANDRA_RACK</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="storage-configuration">Storage configuration<a href="#storage-configuration" class="hash-link" aria-label="Direct link to Storage configuration" title="Direct link to Storage configuration">​</a></h2><p>In the previous version, the only option about storage was the <a href="/casskop/docs/configuration_deployment/storage">data volume configuration</a> allowing you to define :</p><ul><li><code>dataCapacity</code>: Defines the size of the persistent volume claim, for example, "1000Gi".</li><li><code>dataStorageClass</code>: Defines the type of storage to use (or use default one). We recommend to use local-storage for better performances but it can be any storage with high ssd throughput.</li></ul><p>The dynamic sidecar doesn’t really suit, unless you put everything in one folder.</p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Spoiler alert</div><div class="admonitionContent_S0QG"><p>It’s not a good idea</p></div></div><p>That is why we add the <code>CassandraCluster.Spec.StorageConfig</code> field, to the <code>CassandraCluster</code> resource definition :</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">storageConfigs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"/var/lib/cassandra/log"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"gc-logs"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token key atrule">pvcSpec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">storageClassName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> local</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">storage</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 5Gi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"/var/log/cassandra"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"cassandra-logs"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token key atrule">pvcSpec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">storageClassName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> local</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">storage</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10Gi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>storageConfigs</code> : Defines the list of storage config object, which will instantiate <code>Persitence Volume Claim</code> and associate volume to pod of cassandra node.</p><ul><li><code>mountPath</code>: Defines the path into cassandra container where the volume will be mounted.</li><li><code>name</code>: Used to define the PVC and VolumeMount names.</li><li><code>pvcSpec</code>: pvcSpec describes the PVC used for the mountPath described above, it requires a kubernetes PVC spec.</li></ul><p>In this example, we add the two volumes required by our sidecars previously configured, to be able via the sidecars to access to the logs that we want to expose on the stdout.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="volume-claim-template-and-statefulset">Volume Claim Template and statefulset<a href="#volume-claim-template-and-statefulset" class="hash-link" aria-label="Direct link to Volume Claim Template and statefulset" title="Direct link to Volume Claim Template and statefulset">​</a></h2><p>Keep in mind that Casskop operator works on Statefulset, but have some constraints such as :</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">updates to statefulset spec for fields other than 'replicas', 'template', and 'updateStrategy' are forbidden.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So if you want to add or remove some storages configurations, today you have to perform manually it, by removing the Statefulset, which will be recreated by the operator.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>It’s not a sake operation, and should be performed carefully, because you will loose a rack. Maybe in some releases we will manage it, but today we assume that this operation is an exceptional one.</p></div></div><p><a href="https://github.com/cscetbon/casskop" target="_blank" rel="noopener noreferrer">CassKop</a> is open source so don’t hesitate to try it out, contribute by first trying to fix a discovered issue and let’s enhance it together!</p><p>In a next post, I will speak about the IP management into Casskop, and the <a href="https://github.com/cscetbon/casskop/issues/170" target="_blank" rel="noopener noreferrer">cross IPs issue</a>, so stay connected !</p>]]></content:encoded>
            <category>casskop</category>
            <category>cassandra</category>
            <category>0.5.2</category>
            <category>sidecars</category>
            <category>storage</category>
        </item>
        <item>
            <title><![CDATA[Multi-Casskop on Google Kubernetes Engine]]></title>
            <link>https://cscetbon.github.io/casskop/blog/2020/01/15/multicasskop_gke</link>
            <guid>https://cscetbon.github.io/casskop/blog/2020/01/15/multicasskop_gke</guid>
            <pubDate>Wed, 15 Jan 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Pre-requisites]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites">Pre-requisites<a href="#pre-requisites" class="hash-link" aria-label="Direct link to Pre-requisites" title="Direct link to Pre-requisites">​</a></h2><p>User should need :</p><ul><li><a href="https://learn.hashicorp.com/terraform/getting-started/install.html" target="_blank" rel="noopener noreferrer">terraform</a> version v0.12.7+</li><li><a href="https://kubernetes.io/fr/docs/tasks/tools/install-kubectl" target="_blank" rel="noopener noreferrer">kubectl</a> version v1.13.3+</li><li><a href="https://github.com/ahmetb/kubectx" target="_blank" rel="noopener noreferrer">kubectx</a> &amp; kubens</li><li><a href="https://helm.sh/docs/intro/using_helm/" target="_blank" rel="noopener noreferrer">Helm</a> version v2.15.1+</li><li><a href="https://cloud.google.com/sdk/install?hl=fr" target="_blank" rel="noopener noreferrer">gcloud sdk</a> version 272.0.0+</li><li>A service account with enough rights (for this example : <code>editor</code>)</li><li>Having a DNS zone in google cloud dns.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-gcp-environment">Setup GCP environment<a href="#setup-gcp-environment" class="hash-link" aria-label="Direct link to Setup GCP environment" title="Direct link to Setup GCP environment">​</a></h2><p>To setup the GCP environment we will use terraform provisionning, to instantiate the following infrastructure :</p><ul><li>2 GKE clusters :<ul><li>First on europe-west1-b which will be the <code>master</code></li><li>Second on europe-west1-c which will be the <code>slave</code></li></ul></li><li>Firewall rules to allow clusters to communicate</li><li>External DNS on each cluster to expose cassandra nodes</li><li>Casskop operator on each cluster to focus on multi-casskop usage</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="environment-setup">Environment setup<a href="#environment-setup" class="hash-link" aria-label="Direct link to Environment setup" title="Direct link to Environment setup">​</a></h3><p>Start to set variables needed for the instantiation : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export CASSKOP_WORKSPACE=&lt;path to cassandra-k8s-operateur project&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export PROJECT=&lt;gcp project&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export SERVICE_ACCOUNT_KEY_PATH=&lt;path to service account key&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export NAMESPACE=cassandra-demo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export DNS_ZONE_NAME=external-dns-test-gcp-trycatchlearn-fr     # -&gt; change with your own one</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export DNS_NAME=external-dns-test.gcp.trycatchlearn.fr          # -&gt; change with your own one</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export MANAGED_ZONE=tracking-pdb                                # -&gt; change with your own one</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-base-infrastructure">Setup base infrastructure<a href="#setup-base-infrastructure" class="hash-link" aria-label="Direct link to Setup base infrastructure" title="Direct link to Setup base infrastructure">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd ${CASSKOP_WORKSPACE}/multi-casskop/config/samples/gke/terraform</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="master-provisionning">Master provisionning<a href="#master-provisionning" class="hash-link" aria-label="Direct link to Master provisionning" title="Direct link to Master provisionning">​</a></h4><p><img loading="lazy" alt="MultiCasskop architecture" src="/casskop/assets/images/multicasskop_architecture-4ab1ea0d34c7b749dfd848259c6bab1c.jpeg" width="1091" height="788" class="img_ev3q"></p><p>With the master provisionning, we will deploy firewall and Cloud dns configuration :</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform workspace new master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform workspace select master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform apply \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var-file="env/master.tfvars" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="service_account_json_file=${SERVICE_ACCOUNT_KEY_PATH}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="namespace=${NAMESPACE}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="project=${PROJECT}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="dns_zone_name=${DNS_ZONE_NAME}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="dns_name=${DNS_NAME}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="managed_zone=${MANAGED_ZONE}"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="slave-provisionning">Slave provisionning<a href="#slave-provisionning" class="hash-link" aria-label="Direct link to Slave provisionning" title="Direct link to Slave provisionning">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform workspace new slave</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform workspace select slave</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform apply \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var-file="env/slave.tfvars" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="service_account_json_file=${SERVICE_ACCOUNT_KEY_PATH}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="namespace=${NAMESPACE}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="project=${PROJECT}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="dns_zone_name=${DNS_ZONE_NAME}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="dns_name=${DNS_NAME}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="managed_zone=${MANAGED_ZONE}"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-installation">Check installation<a href="#check-installation" class="hash-link" aria-label="Direct link to Check installation" title="Direct link to Check installation">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-master-configuration">Check master configuration<a href="#check-master-configuration" class="hash-link" aria-label="Direct link to Check master configuration" title="Direct link to Check master configuration">​</a></h4><p>Now we will check that everything is well deployed in the GKE master cluster : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ gcloud container clusters get-credentials cassandra-europe-west1-b-master --zone europe-west1-b --project ${PROJECT}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods -n ${NAMESPACE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                          READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">casskop-casskop-54c4cfcbcb-b4qxq   1/1     Running   0          4h9m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">external-dns-6dd96c985-h76gh                  1/1     Running   0          4h16m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-slave-configuration">Check slave configuration<a href="#check-slave-configuration" class="hash-link" aria-label="Direct link to Check slave configuration" title="Direct link to Check slave configuration">​</a></h4><p>Now we will check that everything is well deployed in the GKE slave cluster : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ gcloud container clusters get-credentials cassandra-europe-west1-c-slave --zone europe-west1-c --project ${PROJECT}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods -n ${NAMESPACE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                          READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">casskop-casskop-54c4cfcbcb-sxjz7   1/1     Running   0          4m56s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">external-dns-7f947c5b5b-mq7kg                 1/1     Running   0          5m46s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-dns-zone-configuration">Check DNS zone configuration<a href="#check-dns-zone-configuration" class="hash-link" aria-label="Direct link to Check DNS zone configuration" title="Direct link to Check DNS zone configuration">​</a></h4><p>Make a note of the nameservers that were assigned to your new zone : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ gcloud dns record-sets list \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --zone "${DNS_ZONE_NAME}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --name "${DNS_NAME}." \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --type NS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                     TYPE  TTL    DATA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">external-dns-test.gcp.trycatchlearn.fr.  NS    21600  ns-cloud-e1.googledomains.com.,ns-cloud-e2.googledomains.com.,ns-cloud-e3.googledomains.com.,ns-cloud-e4.googledomains.com.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-firewall-configuration">Check Firewall configuration<a href="#check-firewall-configuration" class="hash-link" aria-label="Direct link to Check Firewall configuration" title="Direct link to Check Firewall configuration">​</a></h4><p>@TODO : rework firewall source</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ gcloud compute firewall-rules describe gke-cassandra-cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">allowed:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- IPProtocol: udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- IPProtocol: tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">creationTimestamp: '2019-12-05T13:31:01.233-08:00'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">description: ''</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">direction: INGRESS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">disabled: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">id: '8270840333953452538'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: compute#firewall</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">logConfig:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  enable: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">name: gke-cassandra-cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">network: https://www.googleapis.com/compute/v1/projects/poc-rtc/global/networks/default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">priority: 1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">selfLink: https://www.googleapis.com/compute/v1/projects/poc-rtc/global/firewalls/gke-cassandra-cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sourceRanges:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- 0.0.0.0/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">targetTags:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- cassandra-cluster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-storage-class">Check Storage Class<a href="#check-storage-class" class="hash-link" aria-label="Direct link to Check Storage Class" title="Direct link to Check Storage Class">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get storageclasses.storage.k8s.io </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                 PROVISIONER            AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">standard (default)   kubernetes.io/gce-pd   28m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">standard-wait        kubernetes.io/gce-pd   24m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-casskop-deployment">Multi casskop deployment<a href="#multi-casskop-deployment" class="hash-link" aria-label="Direct link to Multi casskop deployment" title="Direct link to Multi casskop deployment">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bootstrap-api-access-to-slave-from-master">Bootstrap API access to Slave from Master<a href="#bootstrap-api-access-to-slave-from-master" class="hash-link" aria-label="Direct link to Bootstrap API access to Slave from Master" title="Direct link to Bootstrap API access to Slave from Master">​</a></h3><p>Multi-Casskop will be deployed in <code>master cluster</code>, change your <code>kubectl</code> context to point this cluster.</p><p>In order to allow Multi-CassKop controller to have access to <code>slave</code> from <code>master</code>, we are going to use <a href="https://github.com/admiraltyio/multicluster-service-account/releases/tag/v0.6.1" target="_blank" rel="noopener noreferrer">kubemcsa</a> from <a href="https://admiralty.io/" target="_blank" rel="noopener noreferrer">admiralty</a> to be able to export secret from <code>slave</code> to <code>master</code>.</p><p>Install <code>kubemcsa</code> : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export RELEASE_VERSION=v0.6.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ wget https://github.com/admiraltyio/multicluster-service-account/releases/download/${RELEASE_VERSION}/kubemcsa-linux-amd64</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ mkdir -p ~/tools/kubemcsa/${RELEASE_VERSION} &amp;&amp; mv kubemcsa-linux-amd64 tools/kubemcsa/${RELEASE_VERSION}/kubemcsa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ chmod +x ~/tools/kubemcsa/${RELEASE_VERSION}/kubemcsa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo ln -sfn  ~/tools/kubemcsa/${RELEASE_VERSION}/kubemcsa /usr/local/bin/kubemcsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generate secret for <code>master</code> : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectx # Switch context on master cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Switched to context "gke_&lt;Project name&gt;_europe-west1-b_cassandra-europe-west1-b-master".</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubens # Switch context on correct namespace</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Context "gke_&lt;Project name&gt;_europe-west1-b_cassandra-europe-west1-b-master" modified.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Active namespace is "&lt;Namespace&gt;".</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubemcsa export --context=gke_poc-rtc_europe-west1-c_cassandra-europe-west1-c-slave --namespace ${NAMESPACE} casskop --as gke-slave-west1-c | kubectl apply -f -</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">secret/gke-slave-west1-c created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check that the secret is correctly created</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get secrets -n ${NAMESPACE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gke-slave-west1-c                Opaque                                5      28s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-multi-casskop">Install Multi-CassKop<a href="#install-multi-casskop" class="hash-link" aria-label="Direct link to Install Multi-CassKop" title="Direct link to Install Multi-CassKop">​</a></h3><p>@TODO : To correct once the watch object will be fixed</p><p>Add MultiCasskop crd on the <code>slave</code> cluster : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectx # Switch context on slave cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Switched to context "gke_&lt;Project name&gt;_europe-west1-c_cassandra-europe-west1-c-slave".</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f https://raw.githubusercontent.com/cscetbon/casskop/master/multi-casskop/config/crd/bases/multicluster_v2_cassandramulticluster_crd.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Deployment with Helm : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectx # Switch context on master cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Switched to context "gke_&lt;Project name&gt;_europe-west1-b_cassandra-europe-west1-b-master".</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm init --client-only</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd ${CASSKOP_WORKSPACE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm install --name multi-casskop oci://ghcr.io/cscetbon/multi-casskop-helm --set k8s.local=gke-master-west1-b --set k8s.remote={gke-slave-west1-c} #--no-hooks if crd already install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-multicasskop-crd">Create the MultiCasskop CRD<a href="#create-the-multicasskop-crd" class="hash-link" aria-label="Direct link to Create the MultiCasskop CRD" title="Direct link to Create the MultiCasskop CRD">​</a></h3><p>Now we are ready to deploy a MultiCassKop CRD instance.
We will use the example in <code>multi-casskop/config/samples/gke/multi-casskop-gke.yaml</code> :</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f multi-casskop/config/samples/gke/multi-casskop-gke.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-multi-cluster-installation">Check multi cluster installation<a href="#check-multi-cluster-installation" class="hash-link" aria-label="Direct link to Check multi cluster installation" title="Direct link to Check multi cluster installation">​</a></h3><p>We can see that each cluster has the required pods : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectx # Switch context on master cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Switched to context "gke_&lt;Project name&gt;_europe-west1-b_cassandra-europe-west1-b-master".</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods -n ${NAMESPACE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                          READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cassandra-demo-dc1-rack1-0                    1/1     Running   0          8m30s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">casskop-casskop-54c4cfcbcb-8qncr   1/1     Running   0          34m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">external-dns-6dd96c985-7jf6w                  1/1     Running   0          35m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">multi-casskop-67dc74dff7-z4642                1/1     Running   0          11m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectx # Switch context on slave cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Switched to context "gke_&lt;Project name&gt;_europe-west1-c_cassandra-europe-west1-c-slave".</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods -n ${NAMESPACE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                          READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cassandra-demo-dc3-rack3-0                    1/1     Running   0          6m55s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cassandra-demo-dc4-rack4-0                    1/1     Running   0          4m59s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cassandra-demo-dc4-rack4-1                    1/1     Running   0          3m20s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">casskop-casskop-54c4cfcbcb-sxjz7   1/1     Running   0          71m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">external-dns-7f947c5b5b-mq7kg                 1/1     Running   0          72m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we go in one of the created pods, we can see that nodetool see pods of both clusters : </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectx # Switch context on master cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Switched to context "gke_&lt;Project name&gt;_europe-west1-b_cassandra-europe-west1-b-master".</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl exec -ti cassandra-demo-dc1-rack1-0 nodetool status</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Datacenter: dc1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===============</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Status=Up/Down</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|/ State=Normal/Leaving/Joining/Moving</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--  Address    Load       Tokens       Owns (effective)  Host ID                               Rack</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UN  10.52.2.3  108.62 KiB  256          49.2%             a0958905-e1fa-4410-baca-fc86f4457f1a  rack1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Datacenter: dc3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===============</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Status=Up/Down</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|/ State=Normal/Leaving/Joining/Moving</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--  Address    Load       Tokens       Owns (effective)  Host ID                               Rack</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UN  10.8.3.2   74.95 KiB  256          51.5%             03f8eede-4b69-43be-a0c1-73f73470398b  rack3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Datacenter: dc4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===============</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Status=Up/Down</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|/ State=Normal/Leaving/Joining/Moving</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--  Address    Load       Tokens       Owns (effective)  Host ID                               Rack</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UN  10.8.4.3   107.87 KiB  256          47.8%             1a7432e2-4ca8-4767-acdb-3b40e6ff4a57  rack4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UN  10.8.2.5   107.85 KiB  256          51.6%             272037ce-4146-42c1-9079-ef4561249254  rack4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="clean-up-everything">Clean up everything<a href="#clean-up-everything" class="hash-link" aria-label="Direct link to Clean up everything" title="Direct link to Clean up everything">​</a></h2><p>If you have set the <code>deleteCassandraCluster</code> to true, then when deleting the <code>MultiCassKop</code> object, it will cascade the deletion of the CassandraCluster object in the targeted k8s clusters. Then each local CassKop will delete their Cassandra clusters (else skip this step)</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl delete multicasskops.db.orange.com multi-casskop-demo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm del --purge multi-casskop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cleaning-slave-cluster">Cleaning slave cluster<a href="#cleaning-slave-cluster" class="hash-link" aria-label="Direct link to Cleaning slave cluster" title="Direct link to Cleaning slave cluster">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd ${CASSKOP_WORKSPACE}/multi-casskop/config/samples/gke/terraform</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform workspace select slave</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform destroy \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var-file="env/slave.tfvars" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="service_account_json_file=${SERVICE_ACCOUNT_KEY_PATH}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="namespace=${NAMESPACE}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="project=${PROJECT}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="dns_zone_name=${DNS_ZONE_NAME}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="dns_name=${DNS_NAME}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="managed_zone=${MANAGED_ZONE}"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cleaning-master-cluster">Cleaning master cluster<a href="#cleaning-master-cluster" class="hash-link" aria-label="Direct link to Cleaning master cluster" title="Direct link to Cleaning master cluster">​</a></h3><p>Before running the following command, you need to clean dns records set.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform workspace select master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform destroy \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var-file="env/master.tfvars" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="service_account_json_file=${SERVICE_ACCOUNT_KEY_PATH}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="namespace=${NAMESPACE}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="project=${PROJECT}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="dns_zone_name=${DNS_ZONE_NAME}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="dns_name=${DNS_NAME}" \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -var="managed_zone=${MANAGED_ZONE}"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>gke</category>
            <category>casskop</category>
            <category>cassandra</category>
            <category>external-dns</category>
            <category>multi-casskop</category>
        </item>
    </channel>
</rss>