"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2013],{3929:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"operations/multi_casskop","title":"Multi-CassKop","description":"Here is describes how perform some operations based on the MultiCasskop Operator.","source":"@site/docs/5_operations/4_multi_casskop.md","sourceDirName":"5_operations","slug":"/operations/multi_casskop","permalink":"/casskop/docs/operations/multi_casskop","draft":false,"unlisted":false,"editUrl":"https://github.com/cscetbon/casskop/edit/master/website/docs/5_operations/4_multi_casskop.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Multi-CassKop","sidebar_label":"Multi-CassKop"},"sidebar":"docs","previous":{"title":"Pods Operations","permalink":"/casskop/docs/operations/pods_operations"},"next":{"title":"Backup and restore","permalink":"/casskop/docs/operations/backup_restore"}}');var t=n(4848),a=n(8453);const r={title:"Multi-CassKop",sidebar_label:"Multi-CassKop"},i=void 0,l={},c=[{value:"Remove a Kubernetes site used in a Cassandra Ring",id:"remove-a-kubernetes-site-used-in-a-cassandra-ring",level:2}];function d(e){const s={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"Here is describes how perform some operations based on the MultiCasskop Operator."}),"\n",(0,t.jsx)(s.p,{children:"The MultiCasskop operator manage nothing else than CassandraCluster ressources. Today, this is not through it that you will manage cassandra operations (this is the duty of Cassskop operator).\nSo the only things we will be able to work with are the CassandraCluster's informations and Kubernetes Cluster's client used."}),"\n",(0,t.jsx)(s.h2,{id:"remove-a-kubernetes-site-used-in-a-cassandra-ring",children:"Remove a Kubernetes site used in a Cassandra Ring"}),"\n",(0,t.jsx)(s.p,{children:"Performing a scale down at the MultiCasskop operator level, is by designed scaledown the number of CassandraCluster resource deployed, and so the number of Kubernetes Cluster clients used in the cassandra Ring."}),"\n",(0,t.jsx)(s.p,{children:"To achieve this scaledown the following steps are required :"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["First of all you need to remove all cassandra DC associated to the Kubernetes Cluster client that you want to remove of the ",(0,t.jsx)(s.code,{children:"MultiCasskop"})," resource :"]}),"\n",(0,t.jsx)(s.p,{children:"i - Ensure that there is no more data replicated on it. For example you can check and perform it in following this instructions :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"cqlsh> DESCRIBE keyspace <keyspace name>\n\nCREATE KEYSPACE system_distributed WITH replication = {'class': 'NetworkTopologyStrategy', 'dc1': '1', 'dc2': '1', dc3': '1'}  AND durable_writes = true;\ncqls> ALTER KEYSPACE system_distributed WITH replication = {'class': 'NetworkTopologyStrategy', 'dc1': '1', 'dc3': '1'}  AND durable_writes = true;\n"})}),"\n",(0,t.jsx)(s.p,{children:"ii - Change decrease the number of node per rack for the DC to 0 :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"...\nsite_a:\n  spec:\n    topology:\n      dc:\n        - name: dc1\n          nodesPerRacks: 1\n          config:\n            cassandra-yaml:\n              num_tokens: 256\n          labels:\n            failure-domain.beta.kubernetes.io/region: europe-west1\n          rack:\n            - name: rack1\n              rollingPartition: 0\n              labels:\n                failure-domain.beta.kubernetes.io/zone: europe-west1-b\nsite_b:\n  spec:\n    topology:\n      dc:\n        - name: dc2\n          nodesPerRacks: 0       <---- Downsize to 0\n          config:\n            cassandra-yaml:\n              num_tokens: 256\n          labels:\n            failure-domain.beta.kubernetes.io/region: europe-west1\n          rack:\n            - name: rack1\n              rollingPartition: 0\n              labels:\n                failure-domain.beta.kubernetes.io/zone: europe-west1-c\nsite_c:\n  spec:\n    topology:\n      dc:\n        - name: dc3\n          nodesPerRacks: 1\n          config:\n            cassandra-yaml:\n              num_tokens: 256\n          labels:\n            failure-domain.beta.kubernetes.io/region: europe-west1\n          rack:\n            - name: rack1\n              rollingPartition: 0\n              labels:\n                failure-domain.beta.kubernetes.io/zone: europe-west1-c\n...\n"})}),"\n",(0,t.jsx)(s.p,{children:"iii -  This will perform the downscale of the nodes into the DC."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"2 - Remove all DC from site list :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"...\nsite_b:\n  spec:\n    topology:\n      dc:\n...\n"})}),"\n",(0,t.jsxs)(s.p,{children:["3 - Remove the site of ",(0,t.jsx)(s.code,{children:"MultiCasskop"})," resource.\n4 - Remove manually the ",(0,t.jsx)(s.code,{children:"CassandraCluster"})," resource on the remote site."]})]})}function u(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>i});var o=n(6540);const t={},a=o.createContext(t);function r(e){const s=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),o.createElement(a.Provider,{value:s},e.children)}}}]);