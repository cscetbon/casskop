"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8205],{6485:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"operations/pods_operations","title":"Pods Operations","description":"Here is the list of Operations managed by CassKop at the Pod operations level, which apply at pod level and can be triggered by specifics pods labels. Status of pod operations are also followed up at rack level.","source":"@site/docs/5_operations/2_pods_operations.md","sourceDirName":"5_operations","slug":"/operations/pods_operations","permalink":"/casskop/docs/operations/pods_operations","draft":false,"unlisted":false,"editUrl":"https://github.com/cscetbon/casskop/edit/master/website/docs/5_operations/2_pods_operations.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Pods Operations","sidebar_label":"Pods Operations"},"sidebar":"docs","previous":{"title":"Cluster Operations","permalink":"/casskop/docs/operations/cluster_operations"},"next":{"title":"Multi-CassKop","permalink":"/casskop/docs/operations/multi_casskop"}}');var o=s(4848),r=s(8453);const t={title:"Pods Operations",sidebar_label:"Pods Operations"},c=void 0,i={},d=[{value:"OperationCleanup",id:"operationcleanup",level:2},{value:"OperationRebuild",id:"operationrebuild",level:2},{value:"OperationDecommission",id:"operationdecommission",level:2},{value:"RollingRestart",id:"rollingrestart",level:2}];function l(e){const a={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a.p,{children:["Here is the list of Operations managed by CassKop at the ",(0,o.jsx)(a.strong,{children:"Pod operations"})," level, which apply at pod level and can be triggered by specifics pods labels. Status of pod operations are also followed up at rack level."]}),"\n",(0,o.jsx)(a.p,{children:"Some Pods Operations can be triggered automatically by CassKop if :"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"CassandraCluster.spec.autoPilot"})," is true, that will trigger ",(0,o.jsx)(a.code,{children:"cleanup"}),", ",(0,o.jsx)(a.code,{children:"rebuild"})," and ",(0,o.jsx)(a.code,{children:"upgadesstable"})," operation in\nresponse to cluster events automatically."]}),"\n",(0,o.jsxs)(a.li,{children:["the ",(0,o.jsx)(a.code,{children:"decommission operation"})," is special and will be triggered automatically each time we need to ScaleDown a Pod."]}),"\n",(0,o.jsxs)(a.li,{children:["the ",(0,o.jsx)(a.code,{children:"removenode operation"})," is also special and may be set manually when needed."]}),"\n"]}),"\n",(0,o.jsx)(a.p,{children:'It is also possible to trigger operations "manually", setting some labels on the Pods.'}),"\n",(0,o.jsx)(a.h2,{id:"operationcleanup",children:"OperationCleanup"}),"\n",(0,o.jsxs)(a.p,{children:["A Cleanup may be automatically triggered by CassKop when it ends Scaling the cluster.\nCassKop will set some specific labels on the targeted pods.\nWe can also set these labels manually, or using the privided plugin (",(0,o.jsx)(a.code,{children:"kubectl casskop cleanup start"}),")\nIf we want to see labels for each of the pods of the cluster :"]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-console",children:"$ kubectl label pod $(kubectl get pods -l app=cassandracluster -o jsonpath='{range .items[*]}{.metadata.name}{\" \"}') --list\nListing labels for Pod./cassandra-demo-dc1-rack1-0:\n cluster=k8s.pic\n controller-revision-hash=cassandra-demo-dc1-rack1-56c9bbb958\n dc-rack=dc1-rack1\n statefulset.kubernetes.io/pod-name=cassandra-demo-dc1-rack1-0\n app=cassandracluster\n cassandracluster=cassandra-demo\n cassandraclusters.db.orange.com.dc=dc1\n cassandraclusters.db.orange.com.rack=rack1\n...\n"})}),"\n",(0,o.jsxs)(a.p,{children:["Now, to trigger a ",(0,o.jsx)(a.code,{children:"cleanup"})," on pod ",(0,o.jsx)(a.code,{children:"cassandra-demo-dc1-rack2-0"})]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"kubectl label pod cassandra-demo-dc1-rack2-0 operation-name=cleanup --overwrite\nkubectl label pod cassandra-demo-dc1-rack2-0 operation-status=ToDo --overwrite\n"})}),"\n",(0,o.jsx)(a.p,{children:"Automatically, CassKop will detect the change, start the action, and update the status :"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-yaml",children:"    dc1-rack2:\n      cassandraLastAction:\n        Name: UpdateSeedList\n        endTime: 2018-09-27T15:26:51Z\n        startTime: 2018-09-27T15:23:54Z\n        status: Done\n      phase: Running\n      podLastOperation:\n        Name: cleanup\n        endTime: 2018-09-27T16:00:52Z\n        operatorName: operator-cassandr-f6d2968d4504448180ace041d3818d10-799dbb4zqss8\n        podsOK:\n        - cassandra-demo-dc1-rack2-0\n        - cassandra-demo-dc1-rack2-0\n        startTime: 2018-09-27T16:00:32Z\n        status: Done\n"})}),"\n",(0,o.jsxs)(a.p,{children:["The section ",(0,o.jsx)(a.code,{children:"podLastOperation"})," appears and we can see that it has correctly executed the cleanup operation on the 2\nnodes"]}),"\n",(0,o.jsx)(a.h2,{id:"operationrebuild",children:"OperationRebuild"}),"\n",(0,o.jsx)(a.p,{children:"This operation operates on multiple nodes in the cluster. Use this operation when CassKop add a new datacenter to an\nexisting cluster."}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"kubectl casskop rebuild {--pod <pod_name> | --prefix <prefix_pod_name>} <from-dc_name>\n"})}),"\n",(0,o.jsx)(a.p,{children:"In the background this command is equivalent to set labels on each pods like :"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"kubectl label pod cassandra-demo-dc2-rack1-0 operation-name=rebuild --overwrite\nkubectl label pod cassandra-demo-dc2-rack1-0 operation-status=ToDo --overwrite\nkubectl label pod cassandra-demo-dc2-rack1-0 operation-argument=dc1 --overwrite\n"})}),"\n",(0,o.jsx)(a.h2,{id:"operationdecommission",children:"OperationDecommission"}),"\n",(0,o.jsxs)(a.p,{children:["see ",(0,o.jsx)(a.a,{href:"/casskop/docs/operations/cluster_operations#updatescaledown",children:"UpdateScaleDown"})]}),"\n",(0,o.jsx)(a.h2,{id:"rollingrestart",children:"RollingRestart"}),"\n",(0,o.jsx)(a.p,{children:"This operation can be triggered with the plugin using simple commands as :"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-console",children:"$ kubectl casskop restart --crd cassandra-e2e --rack dc1.rack1 dc2.rack1\n\nNamespace cassandra-e2e\nTrigger restart of dc1.rack1\nTrigger restart of dc2.rack1\n\n$ kubectl casskop restart --crd cassandra-e2e --dc dc1\n\nNamespace cassandra-e2e\nTrigger restart of dc1.rack1\nTrigger restart of dc1.rack2\n\n$ kubectl casskop restart --crd cassandra-e2e --full\n\nNamespace cassandra-e2e\nTrigger restart of dc1.rack1\nTrigger restart of dc1.rack2\nTrigger restart of dc2.rack1\n"})}),"\n",(0,o.jsx)(a.p,{children:"After one of this command, CassKop will do a rolling restart of each rack one at a time avoiding any disruption."})]})}function p(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,o.jsx)(a,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,a,s)=>{s.d(a,{R:()=>t,x:()=>c});var n=s(6540);const o={},r=n.createContext(o);function t(e){const a=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);