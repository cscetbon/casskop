"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5483],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>f});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var u=r.createContext({}),i=function(e){var t=r.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=i(e.components);return r.createElement(u.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=i(a),m=n,f=p["".concat(u,".").concat(m)]||p[m]||d[m]||o;return a?r.createElement(f,s(s({ref:t},c),{},{components:a})):r.createElement(f,s({ref:t},c))}));function f(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,s=new Array(o);s[0]=m;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l[p]="string"==typeof e?e:n,s[1]=l;for(var i=2;i<o;i++)s[i]=a[i];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>s});var r=a(7294),n=a(6010);const o={tabItem:"tabItem_Ymn6"};function s(e){let{children:t,hidden:a,className:s}=e;return r.createElement("div",{role:"tabpanel",className:(0,n.Z)(o.tabItem,s),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>w});var r=a(7462),n=a(7294),o=a(6010),s=a(2466),l=a(6550),u=a(1980),i=a(7392),c=a(12);function p(e){return function(e){return n.Children.map(e,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:a,attributes:r,default:n}}=e;return{value:t,label:a,attributes:r,default:n}}))}function d(e){const{values:t,children:a}=e;return(0,n.useMemo)((()=>{const e=t??p(a);return function(e){const t=(0,i.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function m(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:a}=e;const r=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,u._X)(o),(0,n.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(r.location.search);t.set(o,e),r.replace({...r.location,search:t.toString()})}),[o,r])]}function h(e){const{defaultValue:t,queryString:a=!1,groupId:r}=e,o=d(e),[s,l]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=a.find((e=>e.default))??a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:o}))),[u,i]=f({queryString:a,groupId:r}),[p,h]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,o]=(0,c.Nk)(a);return[r,(0,n.useCallback)((e=>{a&&o.set(e)}),[a,o])]}({groupId:r}),b=(()=>{const e=u??p;return m({value:e,tabValues:o})?e:null})();(0,n.useLayoutEffect)((()=>{b&&l(b)}),[b]);return{selectedValue:s,selectValue:(0,n.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),i(e),h(e)}),[i,h,o]),tabValues:o}}var b=a(2389);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:t,block:a,selectedValue:l,selectValue:u,tabValues:i}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,s.o5)(),d=e=>{const t=e.currentTarget,a=c.indexOf(t),r=i[a].value;r!==l&&(p(t),u(r))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=c.indexOf(e.currentTarget)+1;t=c[a]??c[0];break}case"ArrowLeft":{const a=c.indexOf(e.currentTarget)-1;t=c[a]??c[c.length-1];break}}t?.focus()};return n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":a},t)},i.map((e=>{let{value:t,label:a,attributes:s}=e;return n.createElement("li",(0,r.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:d},s,{className:(0,o.Z)("tabs__item",v.tabItem,s?.className,{"tabs__item--active":l===t})}),a??t)})))}function g(e){let{lazy:t,children:a,selectedValue:r}=e;if(a=Array.isArray(a)?a:[a],t){const e=a.find((e=>e.props.value===r));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return n.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function k(e){const t=h(e);return n.createElement("div",{className:(0,o.Z)("tabs-container",v.tabList)},n.createElement(y,(0,r.Z)({},e,t)),n.createElement(g,(0,r.Z)({},e,t)))}function w(e){const t=(0,b.Z)();return n.createElement(k,(0,r.Z)({key:String(t)},e))}},8219:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>i});var r=a(7462),n=(a(7294),a(3905));a(4866),a(5162);const o={title:"Upgrade v1 to v2",sidebar_label:"Upgrade v1 to v2"},s=void 0,l={unversionedId:"setup/upgrade_v1_to_v2",id:"setup/upgrade_v1_to_v2",title:"Upgrade v1 to v2",description:"Version 2 makes it possible to use Cassandra 3 and 4 using the same bootstrap image. That's why it's recommended to",source:"@site/docs/2_setup/5_upgrade_v1_to_v2.md",sourceDirName:"2_setup",slug:"/setup/upgrade_v1_to_v2",permalink:"/casskop/docs/setup/upgrade_v1_to_v2",draft:!1,editUrl:"https://github.com/cscetbon/casskop/edit/master/website/docs/2_setup/5_upgrade_v1_to_v2.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Upgrade v1 to v2",sidebar_label:"Upgrade v1 to v2"},sidebar:"docs",previous:{title:"MiniKube",permalink:"/casskop/docs/setup/platform_setup/minikube"},next:{title:"Customizable install with Helm",permalink:"/casskop/docs/configuration_deployment/customizable_install_with_helm"}},u={},i=[{value:"Collect your ConfigMap parameters",id:"collect-your-configmap-parameters",level:2},{value:"Uninstall your operator",id:"uninstall-your-operator",level:2},{value:"Update the CRDs",id:"update-the-crds",level:2},{value:"Edit your CassandraCluster object",id:"edit-your-cassandracluster-object",level:2},{value:"Edit your ConfigMap",id:"edit-your-configmap",level:2},{value:"Install the latest version of the operator",id:"install-the-latest-version-of-the-operator",level:2}],c={toc:i},p="wrapper";function d(e){let{components:t,...a}=e;return(0,n.kt)(p,(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Version 2 makes it possible to use Cassandra 3 and 4 using the same bootstrap image. That's why it's recommended to\nupgrade to version 2."),(0,n.kt)("admonition",{type:"warning"},(0,n.kt)("p",{parentName:"admonition"},"It's highly recommended that you test this procedure on a testing environment first.")),(0,n.kt)("p",null,"In order to upgrade to version 2 without impacting your users you need to follow those steps."),(0,n.kt)("h2",{id:"collect-your-configmap-parameters"},"Collect your ConfigMap parameters"),(0,n.kt)("p",null,"If you use a ConfigMap, you can't use parameters other than pre_run.sh and post_run.sh\nCollect all the non default parameters that you use and also the number of tokens. you'll\nneed those when it's time to set the configuration in your CassandraCluster objects."),(0,n.kt)("h2",{id:"uninstall-your-operator"},"Uninstall your operator"),(0,n.kt)("p",null,"You need to uninstall it which won't have any effect on your running cluster other than\nnot allow you to trigger operations, scale it etc..."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"helm delete casskop\n")),(0,n.kt)("h2",{id:"update-the-crds"},"Update the CRDs"),(0,n.kt)("p",null,"helm does not version CRDs, so you'll need to manually update them (You can get the\nnew CRDs from our git repo)."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/crd/bases\n")),(0,n.kt)("h2",{id:"edit-your-cassandracluster-object"},"Edit your CassandraCluster object"),(0,n.kt)("p",null,"Now it's time to edit your object and add the cassandra/java configuration from your configmap in there.\nYou also have to update the bootstrap image version to ",(0,n.kt)("em",{parentName:"p"},"0.1.12"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl edit cassandraclusters.db.orange.com your-object\n")),(0,n.kt)("p",null,"Here is an example of what you could have after you've edited it:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: db.orange.com/v2\nkind: CassandraCluster\nmetadata:\n  name: your-object\nspec:\n  nodesPerRacks: 2\n  cassandraImage: cassandra:3.11.9\n  bootstrapImage: ghcr.io/cscetbon/casskop-bootstrap:0.1.12\n  config:\n    cassandra-yaml:\n      num_tokens: 256\n    jvm-options:\n      initial_heap_size: 32M\n      max_heap_size: 256M\n  dataCapacity: "1Gi"\n  deletePVC: true\n  autoPilot: true\n  resources:\n    limits:\n      cpu: 100m\n      memory: 512Mi\n  topology:\n    dc:\n      - name: dc1\n        rack:\n          - name: rack1\n')),(0,n.kt)("p",null,"If you use a version like ",(0,n.kt)("inlineCode",{parentName:"p"},"cassandra:latest"),", you have to add at the\nsame level a parameter called ",(0,n.kt)("em",{parentName:"p"},"serverVersion")," and set it to the version of\nthe configuration you wanna use cause it's used when generating it."),(0,n.kt)("p",null,"Also you don't have to set the heap and in that case some automatic values\nwill be picked for you."),(0,n.kt)("p",null,"If you have a doubt on what name to use for a parameter in your cassandra.yaml,\nyou can take a look at ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/datastax/cass-config-definitions/tree/1b7eaf4e50447fc8168c4a6c16d0ed986941edf8/resources/cassandra-yaml/cassandra"},"https://github.com/datastax/cass-config-definitions/tree/1b7eaf4e50447fc8168c4a6c16d0ed986941edf8/resources/cassandra-yaml/cassandra")),(0,n.kt)("h2",{id:"edit-your-configmap"},"Edit your ConfigMap"),(0,n.kt)("p",null,"Remove all other keys than pre_run.sh and post_run.sh from your file.\nOf course if you're not using any of those 2 files you can even get rid of this\nConfigMap and remove it from your CassandraCluster object."),(0,n.kt)("h2",{id:"install-the-latest-version-of-the-operator"},"Install the latest version of the operator"),(0,n.kt)("p",null,"Now you can install version 2 of the operator by running the usual install\ncommand:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"helm install casskop oci://ghcr.io/cscetbon/casskop-helm\n")))}d.isMDXComponent=!0}}]);