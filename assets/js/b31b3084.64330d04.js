"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5483],{6523:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var a=n(5893),o=n(1151);const s={title:"Upgrade v1 to v2",sidebar_label:"Upgrade v1 to v2"},r=void 0,i={id:"setup/upgrade_v1_to_v2",title:"Upgrade v1 to v2",description:"Version 2 makes it possible to use Cassandra 3 and 4 using the same bootstrap image. That's why it's recommended to",source:"@site/docs/2_setup/5_upgrade_v1_to_v2.md",sourceDirName:"2_setup",slug:"/setup/upgrade_v1_to_v2",permalink:"/casskop/docs/setup/upgrade_v1_to_v2",draft:!1,unlisted:!1,editUrl:"https://github.com/cscetbon/casskop/edit/master/website/docs/2_setup/5_upgrade_v1_to_v2.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Upgrade v1 to v2",sidebar_label:"Upgrade v1 to v2"},sidebar:"docs",previous:{title:"MiniKube",permalink:"/casskop/docs/setup/platform_setup/minikube"},next:{title:"Customizable install with Helm",permalink:"/casskop/docs/configuration_deployment/customizable_install_with_helm"}},l={},c=[{value:"Collect your ConfigMap parameters",id:"collect-your-configmap-parameters",level:2},{value:"Uninstall your operator",id:"uninstall-your-operator",level:2},{value:"Update the CRDs",id:"update-the-crds",level:2},{value:"Edit your CassandraCluster object",id:"edit-your-cassandracluster-object",level:2},{value:"Edit your ConfigMap",id:"edit-your-configmap",level:2},{value:"Install the latest version of the operator",id:"install-the-latest-version-of-the-operator",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"Version 2 makes it possible to use Cassandra 3 and 4 using the same bootstrap image. That's why it's recommended to\nupgrade to version 2."}),"\n",(0,a.jsx)(t.admonition,{type:"warning",children:(0,a.jsx)(t.p,{children:"It's highly recommended that you test this procedure on a testing environment first."})}),"\n",(0,a.jsx)(t.p,{children:"In order to upgrade to version 2 without impacting your users you need to follow those steps."}),"\n",(0,a.jsx)(t.h2,{id:"collect-your-configmap-parameters",children:"Collect your ConfigMap parameters"}),"\n",(0,a.jsx)(t.p,{children:"If you use a ConfigMap, you can't use parameters other than pre_run.sh and post_run.sh\nCollect all the non default parameters that you use and also the number of tokens. you'll\nneed those when it's time to set the configuration in your CassandraCluster objects."}),"\n",(0,a.jsx)(t.h2,{id:"uninstall-your-operator",children:"Uninstall your operator"}),"\n",(0,a.jsx)(t.p,{children:"You need to uninstall it which won't have any effect on your running cluster other than\nnot allow you to trigger operations, scale it etc..."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"helm delete casskop\n"})}),"\n",(0,a.jsx)(t.h2,{id:"update-the-crds",children:"Update the CRDs"}),"\n",(0,a.jsx)(t.p,{children:"helm does not version CRDs, so you'll need to manually update them (You can get the\nnew CRDs from our git repo)."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"kubectl apply -f config/crd/bases\n"})}),"\n",(0,a.jsx)(t.h2,{id:"edit-your-cassandracluster-object",children:"Edit your CassandraCluster object"}),"\n",(0,a.jsxs)(t.p,{children:["Now it's time to edit your object and add the cassandra/java configuration from your configmap in there.\nYou also have to update the bootstrap image version to ",(0,a.jsx)(t.em,{children:"0.1.14"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"kubectl edit cassandraclusters.db.orange.com your-object\n"})}),"\n",(0,a.jsx)(t.p,{children:"Here is an example of what you could have after you've edited it:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:'apiVersion: db.orange.com/v2\nkind: CassandraCluster\nmetadata:\n  name: your-object\nspec:\n  nodesPerRacks: 2\n  cassandraImage: cassandra:3.11.9\n  bootstrapImage: ghcr.io/cscetbon/casskop-bootstrap:0.1.19\n  config:\n    cassandra-yaml:\n      num_tokens: 256\n    jvm-options:\n      initial_heap_size: 32M\n      max_heap_size: 256M\n  dataCapacity: "1Gi"\n  deletePVC: true\n  autoPilot: true\n  resources:\n    limits:\n      cpu: 100m\n      memory: 512Mi\n  topology:\n    dc:\n      - name: dc1\n        rack:\n          - name: rack1\n'})}),"\n",(0,a.jsxs)(t.p,{children:["If you use a version like ",(0,a.jsx)(t.code,{children:"cassandra:latest"}),", you have to add at the\nsame level a parameter called ",(0,a.jsx)(t.em,{children:"serverVersion"})," and set it to the version of\nthe configuration you wanna use cause it's used when generating it."]}),"\n",(0,a.jsx)(t.p,{children:"Also you don't have to set the heap and in that case some automatic values\nwill be picked for you."}),"\n",(0,a.jsxs)(t.p,{children:["If you have a doubt on what name to use for a parameter in your cassandra.yaml,\nyou can take a look at ",(0,a.jsx)(t.a,{href:"https://github.com/datastax/cass-config-definitions/tree/1b7eaf4e50447fc8168c4a6c16d0ed986941edf8/resources/cassandra-yaml/cassandra",children:"https://github.com/datastax/cass-config-definitions/tree/1b7eaf4e50447fc8168c4a6c16d0ed986941edf8/resources/cassandra-yaml/cassandra"})]}),"\n",(0,a.jsx)(t.h2,{id:"edit-your-configmap",children:"Edit your ConfigMap"}),"\n",(0,a.jsx)(t.p,{children:"Remove all other keys than pre_run.sh and post_run.sh from your file.\nOf course if you're not using any of those 2 files you can even get rid of this\nConfigMap and remove it from your CassandraCluster object."}),"\n",(0,a.jsx)(t.h2,{id:"install-the-latest-version-of-the-operator",children:"Install the latest version of the operator"}),"\n",(0,a.jsx)(t.p,{children:"Now you can install version 2 of the operator by running the usual install\ncommand:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"helm install casskop oci://ghcr.io/cscetbon/casskop-helm\n"})})]})}function u(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>r});var a=n(7294);const o={},s=a.createContext(o);function r(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);